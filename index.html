<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>V2V Config Viewer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #eee;
      margin: 0;
      padding: 0;
    }
    header {
      background: #222;
      padding: 15px;
      text-align: center;
      font-size: 22px;
      color: #ff4444;
    }
    .tabs {
      display: flex;
      justify-content: center;
      background: #1a1a1a;
      border-bottom: 2px solid #333;
    }
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      color: #ccc;
      font-weight: bold;
      border-radius: 8px 8px 0 0;
      margin: 0 5px;
    }
    .tab.red { background: #ff4444; color: white; }
    .tab.green { background: #44cc44; color: white; }
    .content { padding: 20px; }
    .config-box {
      background: #222;
      padding: 12px;
      margin: 10px auto;
      border-radius: 8px;
      text-align: left;
      white-space: pre-wrap;
      word-wrap: break-word;
      position: relative;
    }
    .ping { font-size: 13px; color: #aaa; margin-top: 5px; }
    .btn-group { margin-top: 10px; }
    button {
      background: #ff4444;
      border: none;
      color: white;
      padding: 6px 10px;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
      margin-right: 5px;
    }
    button.green { background: #44cc44; }
    button:hover { opacity: 0.85; }
    .qr-canvas { margin-top: 10px; }
    .section-title {
      font-size: 18px;
      margin-top: 25px;
      margin-bottom: 10px;
      border-bottom: 1px solid #444;
      padding-bottom: 5px;
      color: #ff4444;
    }
  </style>
</head>
<body>
  <header>ğŸ“¡ V2V - Live Configs</header>

  <div class="tabs">
    <div class="tab red" onclick="showTab('xray')">Xray</div>
    <div class="tab green" onclick="showTab('singbox')">Singbox</div>
  </div>

  <div class="content">
    <div id="xray" class="tab-content"></div>
    <div id="singbox" class="tab-content" style="display:none;"></div>

    <div id="subs"></div>
    <div id="clash"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script>
    async function loadConfigs() {
      try {
        const response = await fetch("all_live_configs.json");
        const data = await response.json();

        // Ú©Ø§Ù†ÙÛŒÚ¯â€ŒÙ‡Ø§
        for (const core in data.configs) {
          const container = document.getElementById(core);
          container.innerHTML = "";

          if (data.configs[core].length === 0) {
            container.innerHTML = "<p>âŒ Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯</p>";
            continue;
          }

          data.configs[core].forEach(cfg => {
            const box = document.createElement("div");
            box.className = "config-box";
            
            const configText = document.createElement("div");
            configText.textContent = cfg.config_str;

            const ping = document.createElement("div");
            ping.className = "ping";
            ping.textContent = `Ping: ${cfg.ping}ms`;

            const btnGroup = document.createElement("div");
            btnGroup.className = "btn-group";

            const copyBtn = document.createElement("button");
            copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ";
            copyBtn.onclick = () => {
              navigator.clipboard.writeText(cfg.config_str);
              copyBtn.textContent = "âœ… Ú©Ù¾ÛŒ Ø´Ø¯";
              setTimeout(() => copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ", 2000);
            };

            const qrBtn = document.createElement("button");
            qrBtn.className = (core === "singbox") ? "green" : "";
            qrBtn.textContent = "ğŸ“· QR";
            qrBtn.onclick = () => {
              const qrCanvas = document.createElement("canvas");
              qrCanvas.className = "qr-canvas";
              QRCode.toCanvas(qrCanvas, cfg.config_str, { width: 150 }, err => {
                if (!err) box.appendChild(qrCanvas);
              });
            };

            btnGroup.appendChild(copyBtn);
            btnGroup.appendChild(qrBtn);

            box.appendChild(configText);
            box.appendChild(ping);
            box.appendChild(btnGroup);
            container.appendChild(box);
          });
        }

        // Ù„ÛŒÙ†Ú© Ø³Ø§Ø¨â€ŒÙ‡Ø§
        const subsDiv = document.getElementById("subs");
        subsDiv.innerHTML = '<div class="section-title">ğŸ”— Subscription Links</div>';
        data.subs.forEach(sub => {
          const box = document.createElement("div");
          box.className = "config-box";
          box.textContent = sub;

          const btnGroup = document.createElement("div");
          btnGroup.className = "btn-group";

          const copyBtn = document.createElement("button");
          copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ";
          copyBtn.onclick = () => {
            navigator.clipboard.writeText(sub);
            copyBtn.textContent = "âœ… Ú©Ù¾ÛŒ Ø´Ø¯";
            setTimeout(() => copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ", 2000);
          };

          const qrBtn = document.createElement("button");
          qrBtn.textContent = "ğŸ“· QR";
          qrBtn.onclick = () => {
            const qrCanvas = document.createElement("canvas");
            qrCanvas.className = "qr-canvas";
            QRCode.toCanvas(qrCanvas, sub, { width: 150 }, err => {
              if (!err) box.appendChild(qrCanvas);
            });
          };

          btnGroup.appendChild(copyBtn);
          btnGroup.appendChild(qrBtn);
          box.appendChild(btnGroup);
          subsDiv.appendChild(box);
        });

        // ÙØ§ÛŒÙ„ Ú©Ù„Ø´
        const clashDiv = document.getElementById("clash");
        clashDiv.innerHTML = '<div class="section-title">ğŸ›  Clash Config</div>';
        
        const clashBox = document.createElement("div");
        clashBox.className = "config-box";
        clashBox.textContent = data.clash.url;

        const btnGroup = document.createElement("div");
        btnGroup.className = "btn-group";

        const copyBtn = document.createElement("button");
        copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ URL";
        copyBtn.onclick = () => {
          navigator.clipboard.writeText(data.clash.url);
          copyBtn.textContent = "âœ… Ú©Ù¾ÛŒ Ø´Ø¯";
          setTimeout(() => copyBtn.textContent = "ğŸ“‹ Ú©Ù¾ÛŒ URL", 2000);
        };

        const dlBtn = document.createElement("button");
        dlBtn.textContent = "â¬‡ï¸ Ø¯Ø§Ù†Ù„ÙˆØ¯";
        dlBtn.onclick = () => {
          window.open(data.clash.url, "_blank");
        };

        btnGroup.appendChild(copyBtn);
        btnGroup.appendChild(dlBtn);
        clashBox.appendChild(btnGroup);
        clashDiv.appendChild(clashBox);

      } catch (err) {
        document.getElementById("xray").innerHTML = "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ÙØ§ÛŒÙ„ JSON";
        console.error(err);
      }
    }

    function showTab(tabName) {
      document.querySelectorAll(".tab-content").forEach(el => el.style.display = "none");
      document.getElementById(tabName).style.display = "block";
    }

    loadConfigs();
  </script>
</body>
</html>