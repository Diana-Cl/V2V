name: Deploy Cloudflare Worker

on:
  workflow_dispatch: # Allows manual trigger from GitHub UI
  push:
    branches:
      - main # Or your default branch, e.g., 'master'
    paths:
      - 'worker.js'    # Workflow runs only if worker.js changes
      - 'wrangler.toml'  # Workflow runs only if wrangler.toml changes

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true # Cancel any previous runs if a new one is triggered

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: Deploy Worker to Cloudflare
    permissions:
      contents: read # Required for actions/checkout to clone the repository
      
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4 # ✅ اصلاح شد: اضافه شدن علامت '@' قبل از v4

      - name: Deploy Worker to Cloudflare
        uses: cloudflare/wrangler-action@v3 # ✅ اصلاح شد: اضافه شدن علامت '@' قبل از v3
        with:
          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }} # ✅ اصلاح شد: استفاده از حروف بزرگ برای نام Secret (استاندارد)
          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }} # ✅ اصلاح شد: استفاده از حروف بزرگ برای نام Secret (استاندارد)
          # command: 'deploy --minify' # Optional: uncomment and add specific wrangler CLI commands if needed
