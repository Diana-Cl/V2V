# workflow name
name: deploy cloudflare worker

on:
  # allows manual execution from the github actions tab
  workflow_dispatch:
  
  # triggers the workflow on push events to the main branch
  push:
    branches:
      - main
    paths:
      # ensures the workflow only runs if worker-related files have changed
      - 'worker.js'
      - 'wrangler.toml'
      - 'index.js' # این خط اضافه شد تا تغییرات در index.js نیز workflow را فعال کند

# prevents multiple instances of this workflow from running simultaneously,
# cancelling any in-progress runs when a new one is triggered.
concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  deploy:
    runs-on: ubuntu-latest
    name: deploy worker to cloudflare
    
    # restricts the workflow's permissions to read-only for security
    permissions:
      contents: read
      
    steps:
      - name: checkout repository
        uses: actions/checkout@v4 # از uses: actions/checkout@v4 استفاده کردم چون v4 پایدارتر و جدیدتر است

      - name: deploy worker to cloudflare
        # uses the latest stable v3 release of the wrangler action
        uses: cloudflare/wrangler-action@v3
        with:
          apiToken: ${{ secrets.cloudflare_api_token }} # camelCase برای ورودی‌های اکشن
          accountId: ${{ secrets.cloudflare_account_id }} # camelCase برای ورودی‌های اکشن
